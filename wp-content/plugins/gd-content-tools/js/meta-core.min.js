var gdcet_meta,gdcet_gmap,gdcet_meta_file;!function(l,e,t,a){gdcet_meta_file={handler:null,init:function(){wp&&wp.media&&(void 0===wp.media.frames.gdcet_meta_image_frame&&(wp.media.frames.gdcet_meta_image_frame=new wp.media.view.MediaFrame.Select({title:gdcet_metadata.string_image_title,className:"media-frame gdcet-imagefile-image-frame",multiple:!1,library:{type:"image"},button:{text:gdcet_metadata.string_image_button}}),wp.media.frames.gdcet_meta_image_frame.on("select",function(){var e=wp.media.frames.gdcet_meta_image_frame.state().get("selection").first().toJSON();gdcet_meta_file.handler&&gdcet_meta_file.handler(e)})),void 0===wp.media.frames.gdcet_meta_file_frame&&(wp.media.frames.gdcet_meta_file_frame=new wp.media.view.MediaFrame.Select({title:gdcet_metadata.string_file_title,className:"media-frame gdcet-imagefile-file-frame",multiple:!1,button:{text:gdcet_metadata.string_file_button}}),wp.media.frames.gdcet_meta_file_frame.on("select",function(){var e=wp.media.frames.gdcet_meta_file_frame.state().get("selection").first().toJSON();gdcet_meta_file.handler&&gdcet_meta_file.handler(e)})))},open_image:function(e){gdcet_meta_file.handler=e,wp.media.frames.gdcet_meta_image_frame.open()},open_file:function(e){gdcet_meta_file.handler=e,wp.media.frames.gdcet_meta_file_frame.open()}},gdcet_meta={active_element:null,datetime:".gdcet-control-datetime, .gdcet-control-date, .gdcet-control-time, .gdcet-control-month",init:function(){gdcet_meta_file.init(),gdcet_meta.tabs(),gdcet_meta.live(),gdcet_meta.validator.init(),gdcet_meta.repeater.live(),l(".gdcet-field-inner-field, .gdcet-field-type-simple").each(function(){gdcet_meta.fields.prepare(l(this))})},live:function(){l(t).on("click",".gdcet-control-multiple:not(.gdcet-control-select-enhanced) option",function(){var e=l(this).closest(".gdcet-control-multiple"),t=e.data("maximum-selection-length");0<t&&l("option:selected",e).length>t&&l(this).removeAttr("selected")}),l(t).on("click",".gdcet-block-check-uncheck a",function(e){e.preventDefault();var t="checkall"===l(this).attr("href").substr(1);l(this).parent().parent().find("input[type=checkbox]").prop("checked",t)}),l(t).on("click",".gdcet-button.gdcet-imagefile-preview",function(e){e.preventDefault(),l(this).closest(".gdcet-imagefile-wrapper").find("img").slideToggle(function(){l(this).is(":visible")&&l(this).css("display","block")})}),l(t).on("click",".gdcet-button.gdcet-imagefile-add",function(e){e.preventDefault(),gdcet_meta.active_element=l(this).closest(".gdcet-imagefile-wrapper"),gdcet_meta_file.open_image(gdcet_meta.files.image)}),l(t).on("click",".gdcet-button.gdcet-imagefile-add-file",function(e){e.preventDefault(),gdcet_meta.active_element=l(this).closest(".gdcet-imagefile-wrapper"),gdcet_meta_file.open_file(gdcet_meta.files.file)}),l(t).on("click",".gdcet-button.gdcet-imagefile-clear",function(e){if(e.preventDefault(),confirm(gdcet_metadata.string_are_you_sure)){var t=l(this).closest(".gdcet-imagefile-wrapper");t.find("input").val("0"),t.find("img").attr("src","").hide(),t.find(".gdcet-imagefile-title").html(gdcet_metadata.string_image_not_selected),t.find(".gdcet-imagefile-preview, .gdcet-imagefile-clear").hide()}})},files:{image:function(e){gdcet_meta.files.file(e);var t=gdcet_meta.active_element;l("img",t).attr("src",e.url).hide()},file:function(e){var t=gdcet_meta.active_element;l("input",t).val(e.id),l(".gdcet-imagefile-title",t).html("("+e.id+") "+e.name),l(".gdcet-imagefile-preview, .gdcet-imagefile-clear",t).show()}},tabs:function(){l(".gdcet-render-metabox-tabs-wrapper .wp-tab-bar a").click(function(e){e.preventDefault();var t=l(this).attr("href").substr(1);l(this).closest("ul").find("li").removeClass("wp-tab-active"),l(this).parent().addClass("wp-tab-active"),l(this).closest(".gdcet-render-metabox-tabs-wrapper").find(".wp-tab-panel").removeClass("tabs-panel-active").addClass("tabs-panel-inactive"),l(this).closest(".gdcet-render-metabox-tabs-wrapper").find("#"+t).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")})},fields:{prepare:function(e){l(".gdcet-control-color",e).wpColorPicker(),l(".gdcet-control-slug",e).limitkeypress({rexp:/^[a-z0-9]*[a-z0-9\-\_]*[a-z0-9]*$/}),l(".gdcet-control-text.gdcet-input-regexed",e).each(function(){var e=l(this),t=e.data("gdcet-regex");e.limitkeypress({rexp:gdcet_help.regexp_from_string(t)})}),l(".gdcet-control-text.gdcet-input-masked",e).each(function(){var e=l(this),t=e.data("gdcet-mask");e.mask(t)}),0<l(".gdcet-fontawesome-selector",e).length&&l(".gdcet-fontawesome-selector",e).each(function(){var e=l(this);gdcet_meta.fields.fontawesome(e)}),0<l(gdcet_meta.datetime,e).length&&gdcet_meta.fields.datetime(e),0<l(".gdcet-gmap-wrapper",e).length&&gdcet_gmap.load(e),0<l(".gdcet-content-select-wrapper",e).length&&l(".gdcet-content-select-wrapper",e).each(function(){var e=l(this);gdcet_wp.load(e),gdcet_wp.call(e)}),0<l(".gdcet-control-wpsource-enhanced.gdcet-enhanced-select2",e).length&&gdcet_meta.fields.wp(e),0<l(".gdcet-control-select-enhanced.gdcet-enhanced-select2",e).length&&gdcet_meta.fields.select(e)},datetime:function(e){var t={},a={enableTime:!0,enableSeconds:!0,dateFormat:"Y-m-d H:i:S"},c={enableTime:!0,enableSeconds:!0,noCalendar:!0,dateFormat:"H:i:S"},i={plugins:[new monthSelectPlugin({shorthand:!0,dateFormat:"Y-m"})]};""!==gdcet_metadata.flatpickr_locale&&(t.locale=gdcet_metadata.flatpickr_locale,a.locale=gdcet_metadata.flatpickr_locale,c.locale=gdcet_metadata.flatpickr_locale,i.locale=gdcet_metadata.flatpickr_locale),l(".gdcet-control-date",e).flatpickr(t),l(".gdcet-control-datetime",e).flatpickr(a),l(".gdcet-control-time",e).flatpickr(c),l(".gdcet-control-month",e).flatpickr(i)},fontawesome:function(t){var e=t.find(".d4p-fa-selected");t.find(".d4p-fa-icon").first().before(e),l(".d4p-fa-icon",t).click(function(){var e=l("i",this).data("icon");l(".d4p-fa-selected",t).removeClass("d4p-fa-selected"),l(this).addClass("d4p-fa-selected"),t.prev().val(e)})},select:function(e){var t={width:"100%",closeOnSelect:!1};""!==gdcet_metadata.select2_locale&&(t.language=gdcet_metadata.select2_locale),l(".gdcet-control-select-enhanced.gdcet-enhanced-select2:not(.gdcet-control-get-remote)",e).select2(t),l(".gdcet-control-select-enhanced.gdcet-enhanced-select2.gdcet-control-get-remote",e).each(function(){var t=l(this).data("remote"),a=l(this).closest(".gdcet-render-metabox-wrapper"),e={width:"100%",closeOnSelect:!1,ajax:{url:gdcet_metadata.ajax+"?action=gdcet-metabox-select-remote",dataType:"json",delay:250,data:function(e){return{metabox:a.data("metabox"),nonce:a.data("nonce"),type:a.data("type"),name:a.data("name"),id:a.data("id"),q:e.term,call:t,page:e.page||1,pager:50}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:25*t.page<e.total_count}}},minimumInputLength:1,cache:!0}};""!==gdcet_metadata.select2_locale&&(e.language=gdcet_metadata.select2_locale),l(this).select2(e)})},wp:function(e){l(".gdcet-control-wpsource-enhanced.gdcet-enhanced-select2",e).each(function(){var t=l(this),a=l(this).closest(".gdcet-render-metabox-wrapper"),e={width:"100%",closeOnSelect:!1,ajax:{url:gdcet_metadata.ajax+"?action=gdcet-metabox-wp-search-enhanced",dataType:"json",delay:250,data:function(e){return{metabox:a.data("metabox"),nonce:a.data("nonce"),type:a.data("type"),name:a.data("name"),id:a.data("id"),keyword:e.term,method:t.data("wp"),filter:t.data("filter"),attr:t.data("attr"),page:e.page||1,pager:50}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:25*t.page<e.total_count}}},minimumInputLength:1,cache:!0}};""!==gdcet_metadata.select2_locale&&(e.language=gdcet_metadata.select2_locale),l(this).select2(e)})}},repeater:{live:function(){l(t).on("click","i."+gdcet_metadata.toggler_open+", i."+gdcet_metadata.toggler_close,function(){l(this).hasClass(gdcet_metadata.toggler_open)?l(this).removeClass(gdcet_metadata.toggler_open).addClass(gdcet_metadata.toggler_close).closest(".gdcet-field-repeater").removeClass("gdcet-field-repeater-open"):l(this).removeClass(gdcet_metadata.toggler_close).addClass(gdcet_metadata.toggler_open).closest(".gdcet-field-repeater").addClass("gdcet-field-repeater-open")}),l(t).on("click","i."+gdcet_metadata.repeater_minus,function(){var e=l(this),t=e.closest(".gdcet-field-repeater"),a=e.closest(".gdcet-field-input-wrapper");t.remove(),a.removeClass("gdcet-field-repeater-closed")}),l(t).on("click","i."+gdcet_metadata.repeater_up,function(){var e=l(this).closest(".gdcet-field-repeater"),t=e.prev();e.insertBefore(t)}),l(t).on("click","i."+gdcet_metadata.repeater_down,function(){var e=l(this).closest(".gdcet-field-repeater"),t=e.next();e.insertAfter(t)}),l(t).on("click","i."+gdcet_metadata.repeater_plus,function(){var e=l(this),c=e.closest(".gdcet-field-input-wrapper"),t=e.closest(".gdcet-render-metabox-wrapper"),i=e.closest(".gdcet-field-repeater"),a={metabox:t.data("metabox"),nonce:t.data("nonce"),type:t.data("type"),name:t.data("name"),id:t.data("id"),field:c.data("field"),index:c.data("next-index"),inner:"",parent:0};c.hasClass("gdcet-field-inner-field")&&(a.inner=c.data("inner"),a.parent=c.data("parent")),l.ajax({dataType:"json",data:a,type:"POST",url:gdcet_metadata.ajax+"?action=gdcet-metabox-repeater-field",success:function(e){if(i.find(".dashicons-arrow-up").click(),i.after(e.html),0<l(e.html).find(".gdcet_meta_fields_do_wpeditor").length){var t=JSON.parse(l(e.html).find("script").html());wp.editor.initialize(t.gdcet_id,t)}c.data("next-index",e.index);var a=i.next();gdcet_meta.fields.prepare(a),l(".gdcet-field-repeater",c).length===c.data("limit")&&c.addClass("gdcet-field-repeater-closed")}})})}},validator:{init:function(){0<l(".gdcet-render-metabox-wrapper").length&&("yes"===gdcet_metadata.is_post_edit&&l("#post").submit(gdcet_meta.validator.handler),"yes"===gdcet_metadata.is_term_edit&&l("#edittag").submit(gdcet_meta.validator.handler),"yes"===gdcet_metadata.is_user_edit&&l("#your-profile").submit(gdcet_meta.validator.handler))},handler:function(){var a=!0,c=!1;if(l(".gdcet-render-metabox-wrapper").each(function(){var e=l(this);l(".gdcet-render-metabox-field-required",e).each(function(){var e=l(this);if(e.removeClass("gdcet-required-failed"),0<l(".gdcet-control-required",e).length){var t=!1;l(".gdcet-control-required.gdcet-required-textual",e).each(function(){""!==l(this).val()&&(t=!0)}),l(".gdcet-control-required.gdcet-required-numerical",e).each(function(){""!==l(this).val()&&(t=!0)}),l(".gdcet-control-required.gdcet-required-id",e).each(function(){""!==l(this).val()&&0<parseInt(l(this).val())&&(t=!0)}),!1===t&&(!1===c&&(c=e),e.addClass("gdcet-required-failed"),a=!1)}})}),!1!==c){var e=0;1===l("#wpadminbar").length&&(e=l("#wpadminbar").height()),l("html, body").animate({scrollTop:c.offset().top-e},1e3)}return a}}},gdcet_gmap={load:function(e){l(".gdcet-gmap-wrapper",e).each(function(){var a=l(this),e=JSON.parse(l(".gdcet-gmap-settings",a).html()),t=[e.latitude,e.longitude],n=l(e.id).gmap3({center:t,zoom:e.zoom,streetViewControl:!1}).on({click:function(e,t){this.get(1).setPosition(t.latLng),this.get(2).setPosition(t.latLng),l(".gdcet-gmap-settings-latitude",a).val(t.latLng.lat()),l(".gdcet-gmap-settings-longitude",a).val(t.latLng.lng())}}).marker({position:t,draggable:!0}).on({dragend:function(e,t){l(".gdcet-gmap-settings-latitude",a).val(e.position.lat()),l(".gdcet-gmap-settings-longitude",a).val(e.position.lng())}}).infowindow({position:t,content:e.note}).then(function(e){e.open(this.get(0),this.get(1))});l(".gdcet-gmap-settings-latitude, .gdcet-gmap-settings-longitude",a).keyup(function(){var e,t=parseFloat(l(this).val()),a=n.get(0),c=n.get(1),i=n.get(2),d=c.getPosition();e=l(this).hasClass("gdcet-gmap-settings-latitude")?new google.maps.LatLng({lat:t,lng:d.lng()}):new google.maps.LatLng({lat:d.lat(),lng:t}),a.setCenter(e),c.setPosition(e),i.setPosition(e)}),l(".gdcet-gmap-settings-note",a).keyup(function(){var e=l(this).val();n.get(2).setContent(e)})})}},gdcet_wp={load:function(e){l(".gdcet-search",e).keyup(function(){gdcet_wp.call(e)})},call:function(a){var e=a.closest(".gdcet-render-metabox-wrapper"),t={metabox:e.data("metabox"),nonce:e.data("nonce"),type:e.data("type"),name:e.data("name"),id:e.data("id"),method:a.data("wp"),keyword:a.find(".gdcet-search").val(),filter:a.data("filter"),attr:a.data("attr")};l.ajax({dataType:"json",type:"POST",data:t,url:gdcet_metadata.ajax+"?action=gdcet-metabox-wp-search",success:function(e){var t="<ul>"+e.items.join("")+"</ul>";a.find(".gdcet-content-results ul").remove(),a.find(".gdcet-content-results").append(t),gdcet_wp.prepare(a)}})},prepare:function(c){l(".gdcet-content-results ul li",c).click(function(){var e=l(this)[0].outerHTML,t=l(this).data("item")+"",a=l(".gdcet-selected-items",c).val().split(",");-1===l.inArray(t,a)&&(a.push(t),l(".gdcet-selected-items",c).val(a.join(",")),l(".gdcet-content-selected ul",c).append(e))}),l(t).on("click",".gdcet-content-selected li span",function(){var e=l(this).closest("li").data("item")+"",t=l(".gdcet-selected-items",c).val().split(",");t=gdcet_help.remove_from_array(t,e),l(".gdcet-selected-items",c).val(t.join(",")),l(this).closest("li").remove()})}},gdcet_help={regexp_from_string:function(e){var t=e.replace(/.*\/([gimy]*)$/,"$1"),a=e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1");return new RegExp(a,t)},remove_from_array:function(e,t){var a=e.indexOf(t);return-1<a&&e.splice(a,1),e}},gdcet_meta.init()}(jQuery,window,document);