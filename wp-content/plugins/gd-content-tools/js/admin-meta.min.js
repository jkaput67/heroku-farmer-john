var gdcet_plugin_meta;!function(s,t,e,d){(gdcet_plugin_meta={store:{type:"",el:null,next:0},dialogs:{grid:function(){var e=s.extend({},gdcet_plugin_core.dialogs.defaults(),{width:640,dialogClass:gdcet_plugin_core.dialogs.classes("gdcet-dialog-hidex"),buttons:[{id:"gdcet-delete-field-delete",class:"gdcet-dialog-button-delete",text:gdcet_data.dialog_button_delete,data:{icon:"delete"},click:function(){s("#gdcet-dialog-delete-field-confirm").wpdialog("close"),t.location=gdcet_plugin_core.temp.url}},{id:"gdcet-delete-field-cancel",class:"gdcet-dialog-button-cancel gdcet-button-focus",text:gdcet_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){s("#gdcet-dialog-delete-field-confirm").wpdialog("close")}}]});s("#gdcet-dialog-delete-field-confirm").wpdialog(e),gdcet_plugin_core.dialogs.icons("#gdcet-dialog-delete-field-confirm")},box:function(){var e=s.extend({},gdcet_plugin_core.dialogs.defaults(),{width:640,dialogClass:gdcet_plugin_core.dialogs.classes("gdcet-dialog-hidex"),buttons:[{id:"gdcet-delete-field-delete",class:"gdcet-dialog-button-delete",text:gdcet_data.dialog_button_delete,data:{icon:"delete"},click:function(){s("#gdcet-dialog-delete-element-confirm").wpdialog("close"),gdcet_plugin_meta.store.el.fadeOut("slow",function(){s(this).remove(),gdcet_plugin_meta.boxes.update()})}},{id:"gdcet-delete-field-cancel",class:"gdcet-dialog-button-cancel gdcet-button-focus",text:gdcet_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){s("#gdcet-dialog-delete-element-confirm").wpdialog("close")}}]});s("#gdcet-dialog-delete-element-confirm").wpdialog(e),gdcet_plugin_core.dialogs.icons("#gdcet-dialog-delete-element-confirm")},field:function(){var e=s.extend({},gdcet_plugin_core.dialogs.defaults(),{width:640,dialogClass:gdcet_plugin_core.dialogs.classes("gdcet-dialog-hidex"),buttons:[{id:"gdcet-delete-field-delete",class:"gdcet-dialog-button-delete",text:gdcet_data.dialog_button_delete,data:{icon:"delete"},click:function(){s("#gdcet-dialog-delete-element-confirm").wpdialog("close"),gdcet_plugin_meta.store.el.fadeOut("slow",function(){s(this).remove(),gdcet_plugin_meta.helpers.save_order()})}},{id:"gdcet-delete-field-cancel",class:"gdcet-dialog-button-cancel gdcet-button-focus",text:gdcet_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){s("#gdcet-dialog-delete-element-confirm").wpdialog("close")}}]});s("#gdcet-dialog-delete-element-confirm").wpdialog(e),gdcet_plugin_core.dialogs.icons("#gdcet-dialog-delete-element-confirm")}},init:function(){if("meta-boxes"===gdcet_data.page)gdcet_plugin_meta.store.type=s("#gdcet-meta-box-editor-type").val(),""===gdcet_plugin_meta.store.type?(gdcet_plugin_meta.dialogs.grid(),gdcet_plugin_meta.boxes.grid()):(gdcet_plugin_meta.dialogs.box(),gdcet_plugin_meta.boxes.live(),gdcet_plugin_meta.boxes.box(),s(".gdcet-group-meta-field").each(function(){gdcet_plugin_meta.boxes.hook(s(this))}));else if("meta-fields"===gdcet_data.page)if(gdcet_plugin_meta.store.type=s("#gdcet-meta-field-editor-type").val(),""===gdcet_plugin_meta.store.type)gdcet_plugin_meta.dialogs.grid(),gdcet_plugin_meta.fields.grid();else{switch(gdcet_plugin_meta.fields.live(),gdcet_plugin_meta.store.type){case"simple":gdcet_plugin_meta.fields.simple();break;case"custom":gdcet_plugin_meta.dialogs.field(),gdcet_plugin_meta.fields.custom()}s(".gdcet-group-meta-field").each(function(){gdcet_plugin_meta.fields.hook(s(this))})}},boxes:{grid:function(){},live:function(){gdcet_plugin_meta.shared.live(),s(e).on("keyup",".gdcet-box-property-label",function(){var e=s(this).val();s(this).closest(".gdcet-group-meta-field").find("h3 .gdcet-field-name").html(e)})},hook:function(e){gdcet_plugin_meta.elements.hook_box(e)},box:function(){gdcet_plugin_meta.store.next=s("#gdcet-meta-box-fields-count").val(),s("#gdcet-tool-legacy").click(function(e){var t=""!==s(".gdcet-field-property-basic-label").val(),d=""!==s(".gdcet-field-property-basic-slug").val();t&&d||(e.preventDefault(),alert(gdcet_data_meta.validation_label_slug)),0===s(".gdcet-meta-fields-list-wrapper > div").length&&(e.preventDefault(),alert(gdcet_data_meta.validation_meta_fields))}),s(".gdcet-meta-fields-control a").click(function(e){e.preventDefault();var t=s("#gdcet-box-meta-fields-holder .gdcet-meta-box-single-field").clone().fadeIn();gdcet_plugin_meta.store.next++,t.data("field",gdcet_plugin_meta.store.next),s(t).find("input, select").each(function(){s(this).attr("name",s(this).attr("name").replace("%id%",gdcet_plugin_meta.store.next))}),s(".gdcet-meta-fields-list-wrapper").append(t),gdcet_plugin_meta.elements.hook_box(t),gdcet_plugin_meta.boxes.update()}),s(".gdcet-meta-fields-list-wrapper").sortable({items:".gdcet-group-meta-field",cursor:"move",containment:".gdcet-meta-fields-list",handle:"h3.gdcet-group-sort-handler",placeholder:"gdcet-field-placeholder",scrollSensitivity:32,forceHelperSize:!0,start:function(e,t){t.item.addClass("gdcet-field-dragged"),t.placeholder.height(t.item.height()+2).width(t.item.width())},stop:function(e,t){t.item.removeClass("gdcet-field-dragged")}})},update:function(){0<s(".gdcet-meta-fields-list-wrapper > div").length?(s(".gdcet-meta-fields-empty").hide(),s(".gdcet-meta-fields-list-wrapper").show()):(s(".gdcet-meta-fields-empty").show(),s(".gdcet-meta-fields-list-wrapper").hide())}},fields:{grid:function(){s(".gdcet-action-delete-field").click(function(e){e.preventDefault(),gdcet_plugin_core.temp.url=s(this).attr("href"),s("#gdcet-dialog-delete-field-confirm").wpdialog("open")})},live:function(){s(e).on("change",".gdcet-field-property-basic-type",function(){var e=s(this).val(),t=s(this).find("option:selected"),d=t.data("icon"),l=t.html(),i=s(this).closest(".gdcet-group-meta-field"),a=i.data("field"),c=s(this).closest(".d4p-group-inner").find(".gdcet-field-block-settings"),o=s(this).closest(".gdcet-field-block-type").next();o.show(),c.hide(),s.ajax({dataType:"html",data:{id:a,type:e},type:"POST",url:ajaxurl+"?action=gdcet-meta-change-field-type&_ajax_nonce="+gdcet_data.nonce,success:function(e){i.find(".gdcet-field-icon i").attr("class","fa fa-"+d).attr("title",l),o.hide(),c.html(e).show(),gdcet_plugin_meta.elements.hook_field(c),s("html").animate({scrollTop:c.offset().top-64},700)}})}),s(e).on("keyup",".gdcet-field-property-basic-label",function(){var e=s(this).val();s(this).closest(".gdcet-group-meta-field").find("h3 .gdcet-field-name").html(e)}),s(e).on("click",".gdcet-list-switch-normal-edit",function(e){e.preventDefault();var t=s(this).closest("tr"),d=t.find("td"),l=s(this).closest("th"),i=t.hasClass("gdcet-select-mode-plain");gdcet_plugin_meta.helpers.textarea_to_items(t,i),s(this).hide(),s(".gdcet-list-switch-mass-edit",l).show(),s(".gdcet-meta-items-wrapper-list",d).show(),s(".gdcet-meta-items-wrapper-textarea",d).hide()}),s(e).on("click",".gdcet-list-switch-mass-edit",function(e){e.preventDefault();var t=s(this).closest("tr"),d=t.find("td"),l=s(this).closest("th"),i=t.hasClass("gdcet-select-mode-plain");gdcet_plugin_meta.helpers.items_to_textarea(t,i),s(this).hide(),s(".gdcet-list-switch-normal-edit",l).show(),s(".gdcet-meta-items-wrapper-list",d).hide(),s(".gdcet-meta-items-wrapper-textarea",d).show()}),s(e).on("click",".gdcet-meta-items-list .gdcet-item-ctrl .fa-plus-circle",function(){var e=s(this).closest("table").find("tfoot tr").clone().fadeIn("slow"),t=s(this).closest("table").parent().parent(),d=t.find(".gdcet-list-items-counter").val();d++,t.find(".gdcet-list-items-counter").val(d),s(e).data("item",d),s(e).find(".gdcet-item-default input").val(d),s(e).find(".gdcet-item-data input").each(function(){s(this).attr("name",s(this).attr("name").replace("%id%",d))}),s(this).closest("tr").after(e)}),s(e).on("click",".gdcet-meta-items-list .gdcet-item-ctrl .fa-minus-circle",function(){s(this).closest("tr").fadeOut(function(){s(this).remove()})}),gdcet_plugin_meta.shared.live()},hook:function(e){gdcet_plugin_meta.shared.hook(e),gdcet_plugin_meta.elements.hook_field(e)},simple:function(){var e;if(s("#gdcet-tool-simple").click(function(e){var t=""!==s(".gdcet-field-property-basic-label").val(),d=""!==s(".gdcet-field-property-basic-slug").val();t&&d||(e.preventDefault(),alert(gdcet_data_meta.validation_label_slug))}),"undefined"!=typeof gdcet_meta_errors_keys)for(e=0;e<gdcet_meta_errors_keys.length;e++){var t=gdcet_meta_errors_keys[e];""!==t&&s(".gdcet-field-property-"+t).closest("tr").addClass("d4p-settings-item-error")}},custom:function(){if(gdcet_plugin_meta.store.next=s("#gdcet-meta-field-fields-count").val(),"undefined"!=typeof gdcet_meta_errors_keys){var l;for(l=0;l<gdcet_meta_errors_keys.field.length;l++){var e=gdcet_meta_errors_keys.field[l];""!==e&&s(".gdcet-group-field-main .gdcet-field-property-"+e).closest("tr").addClass("d4p-settings-item-error")}s.each(gdcet_meta_errors_keys.items,function(e,t){for(l=0;l<t.length;l++){var d=t[l];""!==d&&(s("#gdcet-field-element-"+e+" .gdcet-field-property-"+d).closest("tr").addClass("d4p-settings-item-error"),s("#gdcet-field-element-"+e).hasClass("gdcet-meta-closed")&&gdcet_plugin_meta.helpers.toggle_field(s("#gdcet-field-element-"+e).find(".gdcet-field-toggler i")))}})}s(".gdcet-meta-fields-list-wrapper").sortable({items:".gdcet-group-meta-field",cursor:"move",containment:".gdcet-meta-fields-list",handle:"h3.gdcet-group-sort-handler",placeholder:"gdcet-field-placeholder",scrollSensitivity:32,forceHelperSize:!0,start:function(e,t){t.item.addClass("gdcet-field-dragged"),t.placeholder.height(t.item.height()+2).width(t.item.width())},stop:function(e,t){t.item.removeClass("gdcet-field-dragged")},update:function(e,t){gdcet_plugin_meta.helpers.save_order()}}),s(".gdcet-meta-fields-control a").click(function(e){e.preventDefault(),gdcet_plugin_meta.store.next++,s.ajax({dataType:"html",data:{id:gdcet_plugin_meta.store.next},type:"POST",url:ajaxurl+"?action=gdcet-meta-add-basic-field&_ajax_nonce="+gdcet_data.nonce,success:function(e){s(".gdcet-meta-fields-list-wrapper").append(e);var t=s(".gdcet-group-meta-field").last();gdcet_plugin_meta.fields.hook(t),s("html").animate({scrollTop:t.offset().top-64},700)}})})}},elements:{hook_box:function(e){s(".gdcet-metabox-field-field-id",e).change(function(){var e=s(this).find("option:selected").html();s(this).closest(".gdcet-group-meta-field").find(".gdcet-field-name").html(e)}),s(".gdcet-metabox-field-field-id",e).change(),gdcet_plugin_meta.shared.hook(e)},hook_field:function(e){var t={},d={enableTime:!0,enableSeconds:!0,dateFormat:"Y-m-d H:i:S"},l={enableTime:!0,enableSeconds:!0,noCalendar:!0,dateFormat:"H:i:S"},i={plugins:[new monthSelectPlugin({shorthand:!0,dateFormat:"Y-m"})]};if(""!==gdcet_data_meta.flatpickr_locale&&(t.locale=gdcet_data_meta.flatpickr_locale,d.locale=gdcet_data_meta.flatpickr_locale,l.locale=gdcet_data_meta.flatpickr_locale,i.locale=gdcet_data_meta.flatpickr_locale),s(".gdcet-datetime-date",e).flatpickr(t),s(".gdcet-datetime-datetime",e).flatpickr(d),s(".gdcet-datetime-time",e).flatpickr(l),s(".gdcet-datetime-month",e).flatpickr(i),s(".gdcet-field-color",e).wpColorPicker(),s(".gdcet-field-slug",e).limitkeypress({rexp:/^[a-z0-9]*[a-z0-9\-\_]*[a-z0-9]*$/}),s(".gdcet-select-with-options",e).change(function(){var e=s(this).closest(".form-table"),t=s(this).val(),d=s(this).data("select");s(".gdcet-select-"+d,e).hide(),s(".gdcet-select-"+d+"-"+t,e).show()}),s(".gdcet-meta-items-list tbody",e).sortable({items:".gdcet-meta-items-list-item",cursor:"move",handle:".gdcet-item-move",placeholder:"gdcet-field-placeholder",scrollSensitivity:32,forceHelperSize:!0,start:function(e,t){t.item.addClass("gdcet-field-dragged"),t.placeholder.height(t.item.height()+2).width(t.item.width())},stop:function(e,t){t.item.removeClass("gdcet-field-dragged")}}),s(".gdcet-field-property-settings-mode",e).change(function(){var e=s(this).closest(".form-table").find(".gdcet-select-source-list");"normal"===s(this).val()?e.addClass("gdcet-select-mode-plain"):e.removeClass("gdcet-select-mode-plain")}),0<s(".gdcet-fontawesome-selector",e).length){var a=s(".gdcet-fontawesome-selector",e),c=a.find(".d4p-fa-selected");a.find(".d4p-fa-icon").first().before(c),s(".d4p-fa-icon",a).click(function(){var e=s("i",this).data("icon");s(".d4p-fa-selected",a).removeClass("d4p-fa-selected"),s(this).addClass("d4p-fa-selected"),a.prev().val(e)})}}},shared:{live:function(){s(e).on("change",".gdcet-field-switch-property",function(){var e=s(this).closest("tr").next();s(this).is(":checked")?e.show():e.hide()}),s(e).on("click",".gdcet-field-block-control input",function(e){e.preventDefault(),gdcet_plugin_meta.store.el=s(this).closest(".gdcet-group-meta-field"),s("#gdcet-dialog-delete-element-confirm").wpdialog("open")})},hook:function(e){s(".gdcet-field-property-basic-slug",e).limitkeypress({rexp:/^[a-z0-9]*[a-z0-9\-\_]*[a-z0-9]*$/}),s(".gdcet-field-toggler i",e).click(function(){gdcet_plugin_meta.helpers.toggle_field(s(this))}),s(".gdcet-field-move-up",e).click(function(e){e.preventDefault();var t=s(this).closest(".gdcet-group-meta-field"),d=t.prev();t.insertBefore(d)}),s(".gdcet-field-move-down",e).click(function(e){e.preventDefault();var t=s(this).closest(".gdcet-group-meta-field"),d=t.next();t.insertAfter(d)})}},helpers:{items_to_textarea:function(e,a){var t=s(".gdcet-meta-items-wrapper-textarea textarea",e),d=s(".gdcet-meta-items-wrapper-list table tbody tr",e),c="";d.each(function(e,t){var d=s("input",t),l=a?"":d[1].value,i=d[2].value;c+=(t=(""!==l?l+"|":"")+i)+"\n"}),t.val(c.trim())},textarea_to_items:function(e,t){var d=s(".gdcet-meta-items-wrapper-textarea textarea",e)[0].value.replace(/\r\n/g,"\n").split("\n"),a=s(".gdcet-meta-items-wrapper-list table tbody",e),c=s(".gdcet-meta-items-wrapper-list table tfoot tr",e),o=0;a.html(""),s.each(d,function(e,t){if(""!==(t=t.trim())){var d=t.split("|"),l=(t=2==d.length?d[0]:"",2==d.length?d[1]:d[0]),i=c.clone().fadeIn("fast");s(i).data("item",o),s(i).find(".gdcet-item-input--value").val(t),s(i).find(".gdcet-item-input--label").val(l),s(i).find(".gdcet-item-default input").val(o),s(i).find(".gdcet-item-data input").each(function(){s(this).attr("name",s(this).attr("name").replace("%id%",o))}),a.append(i),o++}}),s(".gdcet-list-items-counter",e).val(o)},save_order:function(){var e=[];s(".gdcet-meta-fields-list-wrapper .gdcet-group-meta-field").each(function(){e.push(s(this).data("field"))}),s("#gdcet-meta-field-fields-order").val(e.join(","))},toggle_field:function(e){s(e).hasClass(gdcet_data_meta.toggler_open)?s(e).removeClass(gdcet_data_meta.toggler_open).addClass(gdcet_data_meta.toggler_close).closest("h3").removeClass("gdcet-group-sort-handler").closest(".gdcet-group-meta-field").removeClass("gdcet-meta-closed").addClass("gdcet-meta-opened"):s(e).removeClass(gdcet_data_meta.toggler_close).addClass(gdcet_data_meta.toggler_open).closest("h3").addClass("gdcet-group-sort-handler").closest(".gdcet-group-meta-field").removeClass("gdcet-meta-opened").addClass("gdcet-meta-closed")}}}).init()}(jQuery,window,document);