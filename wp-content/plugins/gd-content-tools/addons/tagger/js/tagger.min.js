var gdcet_tagger;(function($,f,g,h){gdcet_tagger={tmp:{tagger:{done:{},list:{},apis:{}}},tagger:{init:function(){$(".tagsdiv").each(function(){var a=$(this).attr("id"),$tts=$(this).parent(),suggests=[],cls="hide-if-no-js",cls_results="gdcet-terms-block";if($.inArray(a,gdcet_tagger_data.taxonomies)>-1){cls+=" gdcet-with-dashicons";cls_results+=" gdcet-with-dashicons";$(this).next(".hide-if-no-js").after("<div id='gdcet-tagger-block' class='"+cls+"'></div>");gdcet_tagger.tmp.tagger.done[a]=false;gdcet_tagger.tmp.tagger.list[a]=[];gdcet_tagger.tmp.tagger.apis[a]=[];if(gdcet_tagger_data.clear_tags==="1"){$("#gdcet-tagger-block",$tts).append('<div class="gdcet-tagger-wrap"><label class="gdcet-clear-label">'+gdcet_tagger_data.text_assigned_tags+':</label> <a class="gdcet-tagger-clear-tags" data-taggerid="'+a+'" href="#">'+gdcet_tagger_data.text_clear_all+'</a></div>')}var b='<div class="gdcet-tagger-wrap"><label class="gdcet-extract-label">'+gdcet_tagger_data.text_suggest+':</label><div class="gdcet-tagger-engines">';if(gdcet_tagger_data.suggest_internal==="1"){suggests.push('<a class="gdcet-tagger-engine" data-taggerid="'+a+'" data-taggerengine="internal" href="#">'+gdcet_tagger_data.text_internal+'</a>')}if(gdcet_tagger_data.suggest_dandelion==="1"){suggests.push('<a class="gdcet-tagger-engine" data-taggerid="'+a+'" data-taggerengine="dandelion" href="#">Dandelion</a>')}if(gdcet_tagger_data.suggest_opencalais==="1"){suggests.push('<a class="gdcet-tagger-engine" data-taggerid="'+a+'" data-taggerengine="opencalais" href="#">OpenCalais</a>')}$("#gdcet-tagger-block",$tts).append(b+suggests.join("")+"</div>");$("#gdcet-tagger-block",$tts).after('<div class="'+cls_results+'" id="gdcet-results-'+a+'"></div>')}});gdcet_tagger.tagger.events()},events:function(){$(g).on("click",".gdcet-tagger-clear-tags",function(e){e.preventDefault();var a=$(this).data("taggerid"),ids=[],i;$("#"+a+" .tagchecklist .ntdelbutton").each(function(){ids[ids.length]=$(this).attr("id")});for(i=0;i<ids.length;i++){$("#"+ids[ids.length-i-1]).click()}});$(g).on("click",".gdcet-tagger-close",function(e){e.preventDefault();var a=$(this).data("taggerid");$("#gdcet-results-"+a).slideUp()});$(g).on("click",".gdcet-tagger-load",function(e){e.preventDefault();var a=$(this).data("taggerid");gdcet_tagger.tagger.load(a)});$(g).on("click",".gdcet-tagger-addall",function(e){e.preventDefault();var a=$(this).data("taggerid"),tagsid="textarea#tax-input-"+a+".the-tags",tags=$(tagsid).val(),i;for(i=0;i<gdcet_tagger.tmp.tagger.list[a].length;i++){tags+=","+gdcet_tagger.tmp.tagger.list[a][i]}$(tagsid).val(tags);var b=$("#tagsdiv-"+a+" .tagsdiv");tagBox.quickClicks(b)});$(g).on("click",".gdcet-tagger-engine",function(e){e.preventDefault();$(this).parent().find(".gdcet-tagger-engine").removeClass("gdcet-activated");$(this).addClass("gdcet-activated");var a=$(this).data("taggerid"),api=$(this).data("taggerengine"),divid="gdcet-results-"+a,run=gdcet_tagger.tmp.tagger.apis[a]!==api;gdcet_tagger.tmp.tagger.apis[a]=api;if(run){gdcet_tagger.tmp.tagger.done[a]=false;gdcet_tagger.tmp.tagger.list[a]=[];$("#"+divid).html("")}if(!gdcet_tagger.tmp.tagger.done[a]){$("#"+divid).append('<div class="gdcet-terms-loader"><span class="spinner is-active"></span>'+gdcet_tagger_data.text_getting_tags+'</div>');$("#"+divid).append('<div class="gdcet-terms-tags"></div>');$("#"+divid).append('<div class="gdcet-terms-tasks"></div>');$("#"+divid+' .gdcet-terms-tasks').append('<a data-taggerid="'+a+'" class="gdcet-tagger-close" href="#">'+gdcet_tagger_data.text_close+'</a>');$("#"+divid+' .gdcet-terms-tasks').append('<a data-taggerid="'+a+'" class="gdcet-tagger-load" href="#">'+gdcet_tagger_data.text_refresh+'</a>');$("#"+divid+' .gdcet-terms-tasks').append('<a data-taggerid="'+a+'" class="gdcet-tagger-addall" href="#">'+gdcet_tagger_data.text_add_all+'</a>');gdcet_tagger.tmp.tagger.done[a]=true}$("#"+divid).show();if(gdcet_tagger.tmp.tagger.list[a].length===0){gdcet_tagger.tagger.load(a)}})},click:function(a,b){var c="textarea#tax-input-"+a+".the-tags",taxbox=$("#tagsdiv-"+a+" .tagsdiv"),tags=$(c).val();tags+=","+b;$(c).val(tags);tagBox.quickClicks(taxbox)},load:function(d){var e="gdcet-results-"+d;$.ajax({type:"post",dataType:"json",url:"admin-ajax.php?action=gdcet_tagger_search_tags&_ajax_nonce="+gdcet_tagger_data.nonce,data:{content:$("#content").val(),title:$("#title").val(),url:gdcet_tagger_data.url,taxonomy:d,api:gdcet_tagger.tmp.tagger.apis[d]},beforeSend:function(){$("#"+e+" .gdcet-terms-loader").show();$("#"+e+" .gdcet-terms-tags").hide();$("#"+e+" .gdcet-terms-tasks").hide()},success:function(b){if(b.tags){gdcet_tagger.tmp.tagger.list[d]=b.tags}$("#"+e+" .gdcet-terms-tags").html('');if(gdcet_tagger.tmp.tagger.list[d].length===0){$("#"+e+" .gdcet-terms-tags").html(gdcet_tagger_data.text_no_tags_found)}else{var i;for(i=0;i<gdcet_tagger.tmp.tagger.list[d].length;i++){var c='<a class="gdcet-tag-button" href="#">'+gdcet_tagger.tmp.tagger.list[d][i]+'</a> ';$("#"+e+" .gdcet-terms-tags").append(c)}}$("#"+e+" .gdcet-terms-loader").hide();$("#"+e+" .gdcet-terms-tags").show();$("#"+e+" .gdcet-terms-tasks").show();$("#"+e+" .gdcet-terms-tags a").click(function(){var a=$(this).html();gdcet_tagger.tagger.click(d,a);return false})}})}}};gdcet_tagger.tagger.init()})(jQuery,window,document);
